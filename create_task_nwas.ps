# Define variables
$TaskName = "Run NWAS Import"
$Description = "Schedules the NWAS import script to run twice daily."
$RscriptPath = "C:\Program Files\R\R-4.5.1\bin\Rscript.exe" # check this is where the relevant version of R is located
$ScriptPath = "C:\Users\Your Name\Desktop\NWAS-Data\Script.R" # script path
$WorkingDirectory = "C:\Users\Your Name\Desktop\NWAS-Data" # The directory where your script is located

# Rscript options: --vanilla ensures a clean session (no .Rprofile, no saved workspace)
$RArgs = "--vanilla `"$ScriptPath`""

# 1. Create an Action: What to run
$Action = New-ScheduledTaskAction -Execute $PythonPath -Argument "`"$ScriptPath`"" -WorkingDirectory $WorkingDirectory

# 2. Create a Trigger: When to run (e.g., daily at 10:00 AM)
$Trigger1 = New-ScheduledTaskTrigger -Daily -At "09:15 AM"
$Trigger2 = New-ScheduledTaskTrigger -Daily -At "10:15 AM"
$Triggers = @($Trigger1, $Trigger2)

# 3. Create Task Settings: Additional configurations
$Settings = New-ScheduledTaskSettingsSet -AllowStartIfOnBatteries -DontStopIfGoingOnBatteries -StartWhenAvailable -RunOnlyIfNetworkAvailable:$false

# 4. Register the Scheduled Task
# For running under the current user:
Register-ScheduledTask -TaskName $TaskName -Description $Description -Action $Action -Trigger $Triggers -Settings $Settings -User $env:UserName -Force

Write-Host "Scheduled task '$TaskName' created successfully!"
